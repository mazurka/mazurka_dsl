#|
a resource that contains information about the list of @users that have favorited @posts
|#
resource @favorites

singular :: favorite
author :: Cameron Bytheway <bytheway.cameron@gmail.com>

;; setup commonly used variables
;; these are executed lazily
Favorites <- favorites:list(PostID)

;; define the resource actions

#|
provides @favorites data and actions for a @post
|#
- main.
read(PostID) ->
  #{
    #|
    collection of @users that have favorited the @post
    |#
    favorites <- [@users:read(Favorite) | Favorite <- Favorites]

    #|
    total length of @users the have favorited the @post
    |#
    count <- length(Favorites)

    post <- @posts:read(PostID)
    favorite <- @favorite(PostID)
    unfavorite <- @unfavorite(PostID)
  }.

#|
adds the @user to the list of @favorites for a @post
|#
- condition in('favorite', Auth/Scopes).
- condition not(in(Auth/OwnerID, Favorites)).
- type unsafe.
favorite(PostID) ->
  _Result <- favorites:add(PostID, Auth/OwnerID)
  read(PostID).

#|
removes the @user from the list of @favorites for a @post
|#
- condition in('favorite', Auth/Scopes).
- condition in(Auth/OwnerID, Favorites).
- type unsafe.
unfavorite(PostID) ->
  _Result <- favorites:remove(PostID, Auth/OwnerID)
  read(PostID).
